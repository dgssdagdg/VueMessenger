(function(){"use strict";var e={1394:function(e,t,s){s.d(t,{I:function(){return h},db:function(){return l},j:function(){return d}});var n=s(6400),o=s(5942),a=s(4155),r=s(7617),i=s(7844);const c={apiKey:"AIzaSyD8k6XEiyqWX31dU5PzZXpuDPtyd7YBVic",authDomain:"vue-messenger-4b5b0.firebaseapp.com",projectId:"vue-messenger-4b5b0",storageBucket:"vue-messenger-4b5b0.appspot.com",messagingSenderId:"908257836357",appId:"1:908257836357:web:bc8c0ff54d3803d051522c",measurementId:"G-GBLMQR18Q2"},u=(0,n.Wp)(c),d=((0,o.P5)(u),(0,a.xI)(u)),l=(0,r.aU)(u),h=(0,i.c7)(u)},5820:function(e,t,s){var n=s(5130),o=s(6768);function a(e,t,s,n,a,r){const i=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.Wv)((0,o.$y)(r.layout),null,{default:(0,o.k6)((()=>[(0,o.bF)(i)])),_:1})}function r(e,t,s,n,a,r){const i=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.Wv)(i)}var i=s(1394),c={created(){i.j.onAuthStateChanged((e=>{e&&this.$store.dispatch("setUserOnlineStatus",!0)}))},name:"main-layout",async mounted(){try{const e=["fetchUsers","fetchUsersNotice","fetchMyChats","fetchMyGroups","fetchMyCanals","fetchMyInfo"];await Promise.all(e.map((e=>this.$store.dispatch(e))))}catch(e){console.error("Error fetching data:",e)}}},u=s(1241);const d=(0,u.A)(c,[["render",r]]);var l=d;function h(e,t,s,n,a,r){const i=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.Wv)(i)}var m={name:"empty-layout"};const f=(0,u.A)(m,[["render",h]]);var p=f,A={components:{MainLayout:l,EmptyLayout:p},computed:{layout(){return(this.$route.meta.layout||"empty")+"-layout"}}};const y=(0,u.A)(A,[["render",a]]);var g=y,v=s(4232);const C=["value"];function S(e,t,s,n,a,r){return(0,o.uX)(),(0,o.CE)("input",{class:(0,v.C4)([{"input-not-empty":s.modelValue.length>0},"input"]),value:s.modelValue,onInput:t[0]||(t[0]=(...e)=>r.updateInput&&r.updateInput(...e)),type:"text"},null,42,C)}var b={props:{modelValue:[String,Number]},methods:{updateInput(e){this.$emit("update:modelValue",e.target.value)}},name:"my-input"};const w=(0,u.A)(b,[["render",S],["__scopeId","data-v-3ababd47"]]);var E=w;const U={class:"messenger-left-users-user-img"},Q={alt:"Avatar-icon"},k={key:0,class:"_my-status messenger-left-users-user-status"},B={class:"messenger-left-users-user-info"},I={class:"messenger-left-users-user-top"},j={class:"messenger-left-users-user-name"},M={class:"messenger-left-users-user-date"},R={class:"messenger-left-users-user-last_message"};function N(e,t,n,a,r,i){const c=(0,o.gN)("lazy");return(0,o.uX)(),(0,o.CE)("div",{onClick:t[0]||(t[0]=e=>i.openChatWindow(n.user)),class:(0,v.C4)(["messenger-left-users-user",{"active-user":i.infoFullActiveChat.id==n.user.id}])},[(0,o.Lk)("div",U,[(0,o.bo)((0,o.Lk)("img",Q,null,512),[[c,n.user.imgSrc?n.user.imgSrc:s(9096)]]),"chatUsers"==n.user.type&&i.changeStatus?((0,o.uX)(),(0,o.CE)("div",k)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",B,[(0,o.Lk)("div",I,[(0,o.Lk)("div",j,(0,v.v_)(n.user.name),1),(0,o.Lk)("div",M,(0,v.v_)(n.user.date),1)]),(0,o.Lk)("div",R,(0,v.v_)(i.userLastReport),1)])],2)}var F={props:{user:{type:Object,required:!0}},methods:{openChatWindow(e){this.$store.commit("SetInfoWindow",e),this.$store.dispatch("fetchActiveChat",e)}},computed:{infoFullActiveChat(){return this.$store.getters.infoFullActiveChat},infoActiveChat(){return this.$store.getters.infoActiveChat},infoUsers(){return this.$store.getters.infoUsers},changeStatus(){const e=this.infoUsers.find((e=>e.id==this.user.id));if(e)return!!e.isOnline},userLastReport(){let e=this.user.body[this.user.body.length-1];return e?"photo"==e.type?"Фотография":"file"==e.type?"Файл":"voice"==e.type?"Голосовое сообщение":e.title:"Сообщение"}},name:"my-users"};const L=(0,u.A)(F,[["render",N],["__scopeId","data-v-34c8f5d9"]]);var x=L;const H={key:0,class:"dropdown-menu"},X=["onClick"],V=["src","alt"];function q(e,t,s,n,a,r){return s.show?((0,o.uX)(),(0,o.CE)("div",H,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.chatDropDownItems,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.title,class:"dropdown-menu-item",onClick:t=>r.openForm(e)},[(0,o.Lk)("img",{src:e.imgSrc,alt:e.title},null,8,V),(0,o.eW)(" "+(0,v.v_)(e.title),1)],8,X)))),128))])):(0,o.Q3)("",!0)}var W={props:{chatDropDownItems:{type:Array,required:!0},show:{type:Boolean,default:!1}},methods:{openForm(e){this.$emit("myaction",e),this.$emit("update:show",!1)}},mounted(){document.addEventListener("click",(e=>{e.target.closest(".dropdown-menu")||!0!==this.show||e.target.parentElementSibling||this.$emit("update:show",!1)}))},name:"my-dropdown"};const O=(0,u.A)(W,[["render",q],["__scopeId","data-v-bfb41942"]]);var J=O,D="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAJCAYAAAA7KqwyAAAABHNCSVQICAgIfAhkiAAAAYdJREFUKJGFkkFqE3EYR9/vP5OoJCQ2U4ONcVGcRaC6qFsRUURwoSjoJdx4Et2JC3cuPIAiCL2AeINCaEkpqBRnphnDtJnM97kSRBAfvOXbPfF/NB5zdrHoPQ5wU6Y3FkVH0DwHDwEIgP5lCu2qOn9frrsGXY9Zc2+e4X4J1ESj0ehckiRRURQGKE1pZxkCLE1pZ/QfYv4AXAr+EQ+3hF92Y2/V+IsojvXk9LSarK9fmMZxfbGquo86nVY5HI4W87y55/BUIhD8PYRrQCo0qxt/WZZlFst1B7x1sij7Ea2DFXbbTJvzeT7DdQNYmvgULExcpG4+1bJ+VVZVDnjU75z53ri2TX6lcdoBclxXcUtQyAw+h+Aj0HWhfUL9OiurQ8ABot5akpvXM3e2BBtBqiRfIg2EHylo4KaJYDcy3v4oFge/Y4CoLMvVcLiR1XX11WEL11jiROgQ2AQSh93GeJfP53t/xgARQFEU3u32CvfVN6GBS1+0sh2FIMMLyT4cH/+cAs3fk/wCurm+AYZIlDMAAAAASUVORK5CYII=";const G=e=>((0,o.Qi)("data-v-4bb6cec8"),e=e(),(0,o.jt)(),e),P={class:"main-chat-text"},T={class:"reply-message-name"},Y={class:"reply-message-type"},K={key:1,class:"main-chat-text-files"},Z={key:0,alt:"file.name",class:"main-chat-text-file-img"},_={class:"main-chat-text-file-block"},z={class:"main-chat-text-file-texts"},$={class:"main-chat-text-file-name"},ee={class:"main-chat-text-file-size"},te=["onClick"],se=["src"],ne={key:3,class:"main-chat-status"},oe=G((()=>(0,o.Lk)("img",{src:D,alt:"check"},null,-1))),ae=[oe],re={class:"main-chat-date"};function ie(e,t,s,n,a,r){const i=(0,o.gN)("lazy");return(0,o.uX)(),(0,o.CE)("div",{class:(0,v.C4)([{"main-chat-item-left":r.myInfo.uid!=s.chatReport.auth},"main-chat-item"])},[(0,o.Lk)("div",P,[s.chatReport.replyMessage?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"reply-message-report",onClick:t[0]||(t[0]=t=>e.$emit("goMessage",s.chatReport.replyMessage.id))},[(0,o.Lk)("div",T,(0,v.v_)(s.chatReport.replyMessage.name),1),(0,o.Lk)("div",Y,(0,v.v_)(s.chatReport.replyMessage.text),1)])):(0,o.Q3)("",!0),s.chatReport.files?((0,o.uX)(),(0,o.CE)("div",K,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.chatReport.files,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.name,class:"main-chat-text-file"},["photo"==s.chatReport.type?(0,o.bo)(((0,o.uX)(),(0,o.CE)("img",Z,null,512)),[[i,e.imgSrc]]):(0,o.Q3)("",!0),(0,o.Lk)("div",_,[(0,o.Lk)("div",z,[(0,o.Lk)("div",$,(0,v.v_)(e.name),1),(0,o.Lk)("div",ee,(0,v.v_)(e.size),1)]),(0,o.Lk)("button",{onClick:t=>r.downloadImage(e),type:"button",class:"main-chat-text-file-download"},"Скачать",8,te)])])))),128))])):(0,o.Q3)("",!0),"audio"==s.chatReport.type?((0,o.uX)(),(0,o.CE)("audio",{key:2,controls:"",src:s.chatReport.audioUrl},null,8,se)):(0,o.Q3)("",!0),(0,o.eW)(" "+(0,v.v_)(s.chatReport.title)+" ",1),r.myInfo.uid==s.chatReport.auth?((0,o.uX)(),(0,o.CE)("div",ne,ae)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",re,(0,v.v_)(s.chatReport.date),1)],2)}s(4603),s(7566),s(8721);var ce=s(7844),ue={data(){return{}},props:{chatReport:{type:Object,required:!0}},computed:{infoActiveChat(){return this.$store.getters.infoActiveChat},myInfo(){return this.$store.getters.myInfo}},methods:{async downloadImage(e){try{(0,ce.qk)((0,ce.KR)(i.I,`images/${e.name}`)).then((t=>{const s=new XMLHttpRequest;s.responseType="blob",s.onload=t=>{const n=s.response,o=document.createElement("a");o.href=window.URL.createObjectURL(n),o.target="_blank",o.download=e.name,o.click()},s.open("GET",t),s.send()})).catch((e=>{}))}catch(t){console.error("Ошибка при загрузке изображения:",t)}}},name:"my-chat-report"};const de=(0,u.A)(ue,[["render",ie],["__scopeId","data-v-4bb6cec8"]]);var le=de;const he={class:"notifications-item"},me={class:"notifications-avatar"},fe=["alt"],pe={class:"notifications-block"},Ae={class:"notifications-box"},ye={class:"notifications-name"},ge={class:"notifications-text"},ve={class:"notifications-date"};function Ce(e,t,n,a,r,i){const c=(0,o.gN)("lazy");return(0,o.uX)(),(0,o.CE)("div",he,[(0,o.Lk)("div",me,[(0,o.bo)((0,o.Lk)("img",{alt:n.notice.name},null,8,fe),[[c,n.notice.imgSrc?n.notice.imgSrc:s(9096)]]),(0,o.eW)(" "+(0,v.v_)(i.getMinutesSinceLastSeen(i.infoUsers)),1)]),(0,o.Lk)("div",pe,[(0,o.Lk)("div",Ae,[(0,o.Lk)("span",ye,(0,v.v_)(n.notice.name),1),(0,o.Lk)("span",ge,(0,v.v_)(n.notice.text),1)]),(0,o.Lk)("div",ve,(0,v.v_)(n.notice.date),1)])])}var Se={computed:{infoFullActiveChat(){return this.$store.getters.infoFullActiveChat},infoUsers(){return this.$store.getters.infoUsers}},methods:{getMinutesSinceLastSeen(e){const t=new Date(e.date),s=new Date,n=s-t,o=Math.floor(n/1e3),a=Math.floor(o/60),r=Math.floor(a/60),i=Math.floor(r/24);return i>0?`${i} ${1===i?"день":"дня"} назад.`:r>0?`${r} ${1===r?"час":"часа"} назад.`:`${a} ${1===a?"минуту":"минуты"} назад.`}},props:{notice:{type:Object,required:!0}},name:"my-notice"};const be=(0,u.A)(Se,[["render",Ce],["__scopeId","data-v-7323cde6"]]);var we=be;const Ee={class:"messenger-left-users-user-img"},Ue={alt:"Avatar-icon"},Qe={key:0,class:"_my-status messenger-left-users-user-status"},ke={class:"messenger-left-users-user-name"};function Be(e,t,n,a,r,i){const c=(0,o.gN)("lazy");return(0,o.uX)(),(0,o.CE)("div",{onClick:t[0]||(t[0]=e=>i.openChatWindow(n.user)),class:"messenger-left-users-user"},[(0,o.Lk)("div",Ee,[(0,o.bo)((0,o.Lk)("img",Ue,null,512),[[c,n.user.imgSrc?n.user.imgSrc:s(9096)]]),n.user.isOnline?((0,o.uX)(),(0,o.CE)("div",Qe)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",ke,(0,v.v_)(n.user.name),1)])}var Ie={props:{user:{type:Object,required:!0}},methods:{openChatWindow(e){this.$store.commit("SetInfoWindow",e),this.$store.dispatch("fetchActiveChat",e),this.$store.commit("SetSearchQuery","")}},name:"my-global-users"};const je=(0,u.A)(Ie,[["render",Be],["__scopeId","data-v-6f321c6e"]]);var Me=je,Re=[E,x,J,le,we,Me],Ne=s(1387),Fe=s(4155);const Le=[{path:"/",name:"about",meta:{layout:"main",requiresAuth:!0},component:()=>s.e(266).then(s.bind(s,8054))},{path:"/login",name:"login",meta:{layout:"empty"},component:()=>s.e(792).then(s.bind(s,792))},{path:"/register",name:"register",meta:{layout:"empty"},component:()=>s.e(965).then(s.bind(s,5965))}],xe=(0,Ne.aE)({history:(0,Ne.LA)("/VueMessenger/"),routes:Le});xe.beforeEach(((e,t,s)=>{const n=e.matched.some((e=>e.meta.requiresAuth));(0,Fe.hg)(i.j,(e=>{n&&!e?s({name:"login"}):s()}))}));var He=xe,Xe=s(782),Ve={state:{showNotification:!1,showPopUp:"",showChatSetting:!1,showAddUserInChat:!1,showUserSetting:!1},getters:{infoShowPopUp:e=>e.showPopUp,infoShowChatSetting:e=>e.showChatSetting,infoShowAddUserInChat:e=>e.showAddUserInChat,infoShowUserSetting:e=>e.showUserSetting},mutations:{showNotification(e,t){e.showNotification=t},showPopUp(e,t){e.showPopUp=t},SetShowChatSetting(e,t){e.showChatSetting=t},setShowAddUserInChat(e,t){e.showAddUserInChat=t},SetShowUserSetting(e,t){e.showUserSetting=t}},actions:{}},qe=(s(4114),s(7617)),We={state:{},getters:{},mutations:{},actions:{async register({commit:e},{email:t,password:s,name:n}){try{const e=await(0,Fe.eJ)(i.j,t,s,n),o=e.user;await(0,qe.BN)((0,qe.H9)(i.db,"/users",o.uid),{name:n,email:t,notice:[],imgSrc:"",isOnline:!1,lastSeen:""})}catch(o){console.log(o)}},async login({dispatch:e,commit:t},{email:s,password:n}){try{await(0,Fe.x9)(i.j,s,n)}catch(o){console.log(o.message)}},async logout({dispatch:e,commit:t}){try{e("setUserOnlineStatus",!1),await(0,Fe.CI)(i.j),He.push("/login")}catch(s){console.log(s.message)}},async setUserOnlineStatus({dispatch:e,commit:t},s){const n=(0,qe.H9)(i.db,`users/${i.j.currentUser.uid}`);await(0,qe.mZ)(n,{isOnline:s,lastSeen:s?null:(new Date).toISOString()})}}},Oe={state:{users:[],notice:[],myChats:[],groups:[],canals:[],notFilterCanals:[],infoWindow:"",activeChat:[],fullActiveChat:"",searchQuery:"",replyMessageUser:"",notFilterActiveChat:[],myInfo:""},getters:{infoUsers:e=>e.users,infoNotice:e=>e.notice,infoMyChats:e=>e.myChats,infoWindow:e=>e.infoWindow,infoActiveChat:e=>e.activeChat,infoFullActiveChat:e=>e.fullActiveChat,infoSearchQuery:e=>e.searchQuery,infoGroups:e=>e.groups,infoCanals:e=>e.canals,infoNotFilterCanals:e=>e.notFilterCanals,infoReplyMessageUser:e=>e.replyMessageUser,infoNotFilterActiveChat:e=>e.notFilterActiveChat,myInfo:e=>e.myInfo,sortedAndSearchedPosts(e){return[...e.notFilterCanals,...e.users].filter((t=>t.name.toLowerCase().includes(e.searchQuery.toLowerCase())))}},mutations:{SetMyInfo(e,t){e.myInfo=t},SetUsers(e,t){e.users=t},SetNotice(e,t){e.notice=t},SetMyChats(e,t){e.myChats=t},SetInfoWindow(e,t){e.infoWindow=t},SetActiveChat(e,t){e.activeChat=t},SetFullActiveChat(e,t){e.fullActiveChat=t},SetSearchQuery(e,t){e.searchQuery=t},SetGroups(e,t){e.groups=t},SetCanals(e,t){e.canals=t},SetNotFilterCanals(e,t){e.notFilterCanals=t},SetReplyMessageUser(e,t){e.replyMessageUser=t},SetNotFilterActiveChat(e,t){e.notFilterActiveChat=t}},actions:{async fetchUsers({commit:e}){try{const t=(0,qe.rJ)(i.db,"users");(0,qe.aQ)(t,(t=>{const s=t.docs.map((e=>({id:e.id,...e.data()})));let n=[];i.j.currentUser&&(n=s.filter((e=>e.id!==i.j.currentUser.uid))),e("SetUsers",n)}),(e=>{console.error("Ошибка при получении пользователей:",e)}))}catch(t){console.error("Ошибка в fetchUsers:",t)}},async fetchUsersNotice({commit:e}){try{const t=(0,qe.H9)(i.db,"users",i.j.lastNotifiedUid);(0,qe.aQ)(t,(t=>{if(t.exists()){const s=t.data().notice;e("SetNotice",s)}else console.log("Документ не существует!")}),(e=>{console.error("Ошибка при получении уведомлений: ",e)}))}catch(t){console.error("Ошибка в fetchUsersNotice: ",t)}},async fetchMyChats({commit:e}){try{const t=(0,qe.rJ)(i.db,"users",i.j.lastNotifiedUid,"mychats");(0,qe.aQ)(t,(t=>{const s=t.docs.map((e=>({id:e.id,...e.data()})));e("SetMyChats",s)}),(e=>{console.error("Ошибка при получении чатов: ",e)}))}catch(t){console.error("Ошибка в fetchMyChats: ",t)}},async fetchMyGroups({commit:e}){try{const t=(0,qe.rJ)(i.db,"users",i.j.lastNotifiedUid,"mygroups"),s=(0,qe.rJ)(i.db,"groups");(0,qe.aQ)(t,(t=>{const n=t.docs.map((e=>({id:e.id,...e.data()})));(0,qe.aQ)(s,(t=>{const s=t.docs.map((e=>({id:e.id,...e.data()}))),o=s.filter((e=>n.some((t=>e.id===t.id))));e("SetGroups",o)}),(e=>{console.error("Ошибка при получении всех групп: ",e)}))}),(e=>{console.error("Ошибка при получении групп пользователя: ",e)}))}catch(t){console.error("Ошибка в fetchMyGroups: ",t)}},async fetchMyCanals({commit:e}){try{const t=(0,qe.rJ)(i.db,"users",i.j.lastNotifiedUid,"mycanals"),s=(0,qe.rJ)(i.db,"canals");(0,qe.aQ)(t,(t=>{const n=t.docs.map((e=>({id:e.id,...e.data()})));(0,qe.aQ)(s,(t=>{const s=t.docs.map((e=>({id:e.id,...e.data()}))),o=s.filter((e=>n.some((t=>e.id===t.id))));e("SetNotFilterCanals",s),e("SetCanals",o)}),(e=>{console.error("Ошибка при получении всех каналов:",e)}))}),(e=>{console.error("Ошибка при получении каналов пользователя:",e)}))}catch(t){console.error("Ошибка в fetchMyCanals:",t)}},async fetchActiveChat({commit:e,getters:t},s){try{if("groups"===s.type||"canals"===s.type){const n=(0,qe.rJ)(i.db,s.type);(0,qe.aQ)(n,(async n=>{const o=n.docs.map((e=>({id:e.id,...e.data()})));if(!o.find((e=>e.id===s.id)))return e("SetActiveChat",[]),e("SetNotFilterActiveChat",[]),e("SetFullActiveChat",t.infoWindow),void e("SetShowChatSetting",!1);const a=o.find((e=>e.id===s.id)),r=a.body.map(((e,t)=>({...e,id:t}))),c=await(0,qe.x7)((0,qe.H9)(i.db,"users",i.j.lastNotifiedUid,`my${s.type}`,s.id));let u=[];if(c.exists()){u=c.data().body;const t=r.filter((e=>!u.includes(e.id)));return e("SetActiveChat",t),e("SetNotFilterActiveChat",r),void e("SetFullActiveChat",a)}return e("SetActiveChat",[]),e("SetNotFilterActiveChat",[]),e("SetFullActiveChat",t.infoWindow),void e("SetShowChatSetting",!1)}))}else{const n=(0,qe.rJ)(i.db,"users",i.j.lastNotifiedUid,"mychats");(0,qe.aQ)(n,(async n=>{const o=n.docs.map((e=>({id:e.id,...e.data()})));if(!o.find((e=>e.id===s.id)))return e("SetActiveChat",[]),void e("SetFullActiveChat",t.infoWindow);const a=o.find((e=>e.id===s.id)),r=a.body.map(((e,t)=>({...e,id:t})));e("SetActiveChat",r),e("SetFullActiveChat",a)}))}}catch(n){console.error("Ошибка при получении активного чата:",n)}finally{e("SetShowChatSetting",!1)}},async fetchReplyMessageUser({commit:e},t){const s=(0,qe.rJ)(i.db,"users");(0,qe.aQ)(s,(s=>{const n=s.docs.map((e=>({id:e.id,...e.data()}))),o=n.find((e=>e.id===t.auth));e("SetReplyMessageUser",o)}),(e=>{console.error("Ошибка при получении пользователей:",e)}))},async fetchMyInfo({commit:e}){try{const t=(0,qe.H9)(i.db,"users",i.j.currentUser.uid);(0,qe.aQ)(t,(t=>{const s=t.data();i.j.currentUser&&(s.uid=i.j.currentUser.uid),e("SetMyInfo",s)}),(e=>{console.error("Ошибка при получении пользователей:",e)}))}catch(t){console.log(t)}}}},Je={state:{},getters:{},mutations:{},actions:{async createChat({commit:e,getters:t},{name:s,imgSrc:n,description:o,type:a,id:r}){try{const e=`users/${i.j.lastNotifiedUid}/mychats`,c=[],u={name:s,imgSrc:n,description:o,type:a,body:[]};if("chatUsers"===a){const s={name:t.myInfo.name,imgSrc:t.myInfo.imgSrc,description:o,type:a,body:[]},n=(0,qe.H9)(i.db,e,r);c.push((0,qe.BN)(n,u));const d=(0,qe.H9)((0,qe.rJ)(i.db,"users",r,"mychats"),i.j.lastNotifiedUid);c.push((0,qe.BN)(d,s))}else if("chat"===a){const t=(0,qe.H9)((0,qe.rJ)(i.db,e));c.push((0,qe.BN)(t,u))}else if("groups"===a||"canals"===a){const e=s,t=(0,qe.H9)((0,qe.rJ)(i.db,"users",i.j.lastNotifiedUid,"groups"===a?"mygroups":"mycanals"),e);c.push((0,qe.BN)(t,{body:[]}));const r=(0,qe.H9)((0,qe.rJ)(i.db,"groups"===a?"groups":"canals"),e),u={name:s,imgSrc:n,description:o,type:a,usersChat:[{uid:i.j.currentUser.uid,admin:!0}],body:[]};c.push((0,qe.BN)(r,u))}await Promise.all(c)}catch(c){console.error(c)}},async addNewReport({commit:e,dispatch:t},{title:s,date:n,position:o,user:a,type:r,files:c,audioUrl:u,replyMessage:d}){try{let e={date:n,position:o,auth:i.j.lastNotifiedUid};"file"===r||"photo"===r?(e.title=s,e.files=c,e.type=r):"audio"===r?(e.audioUrl=u,e.type=r):e.title=s,d&&(e.replyMessage=d);const l=(0,qe.H9)(i.db,"users",i.j.lastNotifiedUid,"mychats",a.id),h=(0,qe.H9)(i.db,"users",a.id,"mychats",i.j.lastNotifiedUid),m=await(0,qe.x7)(l),f=[];if("chatUsers"===a.type||a.email){if(!m.exists()){const e={name:a.name,imgSrc:a.imgSrc,description:"",type:"chatUsers",id:a.id};f.push(t("createChat",e))}f.push((0,qe.mZ)(l,{body:(0,qe.hq)(e)}),(0,qe.mZ)(h,{body:(0,qe.hq)(e)}))}else if("chat"===a.type)f.push((0,qe.mZ)(l,{body:(0,qe.hq)(e)}));else if("groups"===a.type||"canals"===a.type){const t=(0,qe.H9)(i.db,a.type,a.id);f.push((0,qe.mZ)(t,{body:(0,qe.hq)(e)}))}await Promise.all(f)}catch(l){console.error(l)}}}},De={state:{replyMessage:""},getters:{infoReplyMessage:e=>e.replyMessage},mutations:{SetreplyMessage(e,t){e.replyMessage=t}},actions:{async deleteMessage({commit:e,getters:t,dispatch:s},n){try{const e=t.infoFullActiveChat,s=i.j.lastNotifiedUid;if("chat"==e.type||"chatUsers"==e.type){const t=(0,qe.H9)(i.db,"users",s,"mychats",e.id),o=await(0,qe.x7)(t),a=o.data().body;await(0,qe.mZ)(t,{body:a.filter((e=>a.indexOf(e)!=n.id))})}if("groups"==e.type||"canals"==e.type){const o=t.infoNotFilterActiveChat,a=(0,qe.H9)(i.db,"users",s,`my${e.type}`,e.id);await(0,qe.mZ)(a,{body:(0,qe.hq)(o.indexOf(n))})}}catch(o){console.log(o)}finally{s("fetchActiveChat",t.infoFullActiveChat)}},async deleteChatParticipants({commit:e,getters:t,dispatch:s},n){try{let s=n;const o=t.myInfo,a=t.infoFullActiveChat;s.id||(s.id=s.uid);const r=(0,qe.H9)(i.db,a.type,a.id),c=(0,qe.H9)(i.db,"users",s.id,`my${a.type}`,a.id),u=a.usersChat.filter((e=>e.uid!=s.id));await(0,qe.kd)(c),a.usersChat.length<=1?(await(0,qe.kd)(r),e("SetFullActiveChat","")):await(0,qe.mZ)(r,{usersChat:u});const d=await(0,qe.x7)((0,qe.H9)(i.db,"users",i.j.currentUser.uid)),l=d.data(),h={imgSrc:l.imgSrc,name:l.name,text:`удалил(а) Вас из группу «${a.name}»`,date:(new Date).toISOString()};o.uid!=s.uid&&await(0,qe.mZ)((0,qe.H9)(i.db,"users",s.id),{notice:(0,qe.hq)(h)})}catch(o){console.log(o)}},async addNewUserInChat({commit:e,getters:t,dispatch:s},n){try{n.id||(n.id=n.uid);const e=t.infoFullActiveChat,s=t.myInfo,o=(0,qe.H9)(i.db,"users",n.id,`my${e.type}`,e.id),a={uid:n.id,admin:!1},r={imgSrc:s.imgSrc,name:s.name,text:`добавил(а) Вас в группу «${e.name}»`,date:(new Date).toISOString()};await(0,qe.BN)(o,{body:[]}),await(0,qe.mZ)((0,qe.H9)(i.db,e.type,e.id),{usersChat:(0,qe.hq)(a)}),s.uid!=n.uid&&await(0,qe.mZ)((0,qe.H9)(i.db,"users",n.id),{notice:(0,qe.hq)(r)})}catch(o){console.log(o)}},async clearNotice({commit:e,getters:t,dispatch:s}){try{await(0,qe.mZ)((0,qe.H9)(i.db,"users",i.j.currentUser.uid),{notice:[]})}catch(n){console.log(n)}},async changeMyInfoImgSrc({commit:e},t){try{await(0,qe.mZ)((0,qe.H9)(i.db,"users",i.j.currentUser.uid),{imgSrc:t})}catch(s){console.log(s)}}}},Ge=(0,Xe.y$)({state:{},getters:{},mutations:{},actions:{},modules:{messeng:Ve,auth:We,fetchInfo:Oe,createChat:Je,messageMethods:De}}),Pe=s(5847);const Te=(0,n.Ef)(g);Re.forEach((e=>{Te.component(e.name,e)})),Te.use(Pe.A,{preLoad:1.5,error:s(6408),loading:s(4690),attempt:1}),Te.use(Ge).use(He).mount("#app")},6408:function(e,t,s){e.exports=s.p+"img/error.0184cd29.gif"},4690:function(e,t,s){e.exports=s.p+"img/loading.74e8c603.gif"},9096:function(e){e.exports="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCAAwADADASIAAhEBAxEB/8QAHAAAAgIDAQEAAAAAAAAAAAAABwkABgMECAUK/8QALxAAAQQCAQMCAwgDAQAAAAAAAwECBAUGBxESITEACAkTFRQjMlFTYaLBQbHwgf/EABYBAQEBAAAAAAAAAAAAAAAAAAMFBP/EAC0RAAECBQMCBQMFAAAAAAAAAAECEQMSITFBADJRE2EEFCJScUKR8GJjgbHR/9oADAMBAAIRAxEAPwD79ClGAbyle0YhtVz3uXhrWp5VV/5VXsnKr6HtrlkgznCreY4UVU+e5qKcvC/iYjkVBMVPHZSccKqsXlqTLbRxZCVoncBj9Lz8Kv3h3J1NYvHZWiaqLx+o53UnLG8DXIcgpcTorjJsks4lNQUFdMt7i1nE+VEr66AB8mXKO/hVQYQjc5Ua1z3qiMGx73Nau2BABAUoTFTSpZ6G1Mk4HB5sa1YBZrn84175pMiQ5XHOYzl8qUj3r/JV7ft49QMmRHcjgHMFyeFER7F/iqdv28euIcY94FlmKzM0pNG5xB9vlRBvbi53nmFxQ4hATH6WBKljyHHsMsnvyLJ6qzNXzo8RYDhzRISqfMhRzWB4tf4DferlVVXA2HnHtg2vieh7SJWWlPtENljeS2saht3sSHkWZa+p5DrXFKdgVdNlmHaXckUJ0UwIsp1hBEej5WLVPTTShTPDd/ZLM5X+204DGVtDOkVc/LH7u1u9u+mUVWWSAuaKy5kBVUT57Wohxcr+J6NREKxE89kJxyqK9eGqQhFGcbCie0giNRzHtXlrmr4VF/3/AJRey8Knrm/GsloMxoKjKcWt4N9j19BBZVFvWnbIhT4UhvUIwSt/9YQb0aUJWkCYYzDexpOxK0cKQtaV3IZHU8HKr92dqdTmJz2RpWoq8fqNb0py93M6PAABUkSlLzJZrXpgjI+c3ZK8Gr2P5/eqpKMsiTIO5eVMYpVX8+t7nf32ROyeE7elx/ENmWN7T6F1FSUc7NLPYW4YN5Za7gWUGkNn2Fa4q5d/lePrd2U2PDg/NdMp3gaaNJQk1IpxPbJiAh2DHJQVjyZAHJwoTFEqfl0Pc3+uyp2Xynb0ur4i9DargGqthU03KsdXXe2qo+VZ5gopz8xwHW+TUt1R5rkdMSFMjkD9nGSqaRzBOP8AavsD2Ta+OOY8tPwRAjwePpd90hk2sd0u0g+0gsdDEeVXOX+a37PenOgKOp2LmGT7kwPduz4unM79zGqLLHNJ+1hLyZkVLiNPUCbCxWae7rhJhmOkmMxq1qW09WtabI/rORSywBXI3U8bDRbG2tsG71jF1naXANne3rC42D+4H2V25m41j+X49R841k2R4/NsWzcMvh2TJ9dBqotjIs3VkI9NIgSgFI1+QbVZrLZGwKfZIc8ugZ1rrVmA2Gyfa77zhWgGbSjTBih5LjddIyKLZAmZJBqmxrQOXJbQ4MoNlWTmGmh+q0EmryS2bhzvGtSbUxulwTRWKbl1tR5J7ovc5jD6LEtg1cWqlynWkWDYWljALQxMlijpZ8Kyo4dnbz7aXEeQ7KzH+ifRdOTCLMnHTSow2lAbqELgplkL+JTGQBN6iSVf1Pdnqzhy9gyi77CmrU0efh/3V1Cpt36oybG52vrnXm2rS8r9VSyRJwdYYVtET8vxXFau7iSVHc1THrczYsxa6uQr5RpA/mjksFEYdFMseTHO1eFCYRUX8uh7Xf13Rey+F7el8fD2oJ7cB2hsaxLkd63Z+2sitsVz/NplifOc91xSDjUmFXGTR5yqKKdgg2aQ0htBHJGOjQRRQwxCnYPFCsiTHA1OVMYQkT8+t7W/33VeyeV7ep3jJevFs1J7tNInqXJU0024lfuJU+lhvKnnHw9LdmtTimrXltW4UhLITeQyOlh+EX7s7U6WvXjsjStRE5/Ua7qXl7eaNKixpsaRCmxwS4csBYsuJKEORGlRpA3CPHkAK14jAMJ7xlERjhkG5zHtc1yop7KIZxvEVjSCI1WvY5OWuavlFT/lRe6cKnoe2uJyAucWt5kBVVX5DnIhxcr+FiuVEKxE8d0Jxwio9eXLMgRwwQssU7VEsCBYE4Ix273ZSS7gXvpbVj8PXUpn3lVj2f7vwXXWTzvqORajw3YP03Xdqb57SvilqZdRYTGVUtrpIp1c2wVj2viLCLX/AE6KjbdeeyrXmVXAGZTmu1rvWlU/HVxrRkjNZI9SUAMbDWAgQBY6OP8AaZ1cEdW0ESDNsSRoESbPjRhtQkd8Xsw0aRHcrTgMFyeUKN7F/kidv38eoGNIkORoAGM5fCCG96/xRe37+PVHzUYgHrGg3OHDy1mvN6U+p5mo7EgjInCRXH3o3FbW1oxYsaFGjwoUcESHEAKLEiRRDjxosaONogR44BNYIIAiYwYhDY0YxtaxjWtaiJecSq3FkLZFbwGP1MByi/eHcnS56c9laJqqnP6jm9K8sdxKrE5BnNLZcxwoqL8hrkU5eF/C9WqqCYqee6k45REYvDkIQhDANghMaMQ2o1jGpw1rU8Iif7/yq915VfU6PHBBQguVUUoVABuAck5Nm72ZKcn+B/uv/9k="}},t={};function s(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,s),a.exports}s.m=e,function(){var e=[];s.O=function(t,n,o,a){if(!n){var r=1/0;for(d=0;d<e.length;d++){n=e[d][0],o=e[d][1],a=e[d][2];for(var i=!0,c=0;c<n.length;c++)(!1&a||r>=a)&&Object.keys(s.O).every((function(e){return s.O[e](n[c])}))?n.splice(c--,1):(i=!1,a<r&&(r=a));if(i){e.splice(d--,1);var u=o();void 0!==u&&(t=u)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[n,o,a]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){s.f={},s.e=function(e){return Promise.all(Object.keys(s.f).reduce((function(t,n){return s.f[n](e,t),t}),[]))}}(),function(){s.u=function(e){return"js/"+e+"."+{266:"2abefe59",792:"13c00542",965:"4341b080"}[e]+".js"}}(),function(){s.miniCssF=function(e){return"css/"+e+".97f866b3.css"}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="vue-mesenger:";s.l=function(n,o,a,r){if(e[n])e[n].push(o);else{var i,c;if(void 0!==a)for(var u=document.getElementsByTagName("script"),d=0;d<u.length;d++){var l=u[d];if(l.getAttribute("src")==n||l.getAttribute("data-webpack")==t+a){i=l;break}}i||(c=!0,i=document.createElement("script"),i.charset="utf-8",i.timeout=120,s.nc&&i.setAttribute("nonce",s.nc),i.setAttribute("data-webpack",t+a),i.src=n),e[n]=[o];var h=function(t,s){i.onerror=i.onload=null,clearTimeout(m);var o=e[n];if(delete e[n],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach((function(e){return e(s)})),t)return t(s)},m=setTimeout(h.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=h.bind(null,i.onerror),i.onload=h.bind(null,i.onload),c&&document.head.appendChild(i)}}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.p="/VueMessenger/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,n,o,a){var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",s.nc&&(r.nonce=s.nc);var i=function(s){if(r.onerror=r.onload=null,"load"===s.type)o();else{var n=s&&s.type,i=s&&s.target&&s.target.href||t,c=new Error("Loading CSS chunk "+e+" failed.\n("+n+": "+i+")");c.name="ChunkLoadError",c.code="CSS_CHUNK_LOAD_FAILED",c.type=n,c.request=i,r.parentNode&&r.parentNode.removeChild(r),a(c)}};return r.onerror=r.onload=i,r.href=t,n?n.parentNode.insertBefore(r,n.nextSibling):document.head.appendChild(r),r},t=function(e,t){for(var s=document.getElementsByTagName("link"),n=0;n<s.length;n++){var o=s[n],a=o.getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(a===e||a===t))return o}var r=document.getElementsByTagName("style");for(n=0;n<r.length;n++){o=r[n],a=o.getAttribute("data-href");if(a===e||a===t)return o}},n=function(n){return new Promise((function(o,a){var r=s.miniCssF(n),i=s.p+r;if(t(r,i))return o();e(n,i,null,o,a)}))},o={524:0};s.f.miniCss=function(e,t){var s={266:1};o[e]?t.push(o[e]):0!==o[e]&&s[e]&&t.push(o[e]=n(e).then((function(){o[e]=0}),(function(t){throw delete o[e],t})))}}}(),function(){var e={524:0};s.f.j=function(t,n){var o=s.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var a=new Promise((function(s,n){o=e[t]=[s,n]}));n.push(o[2]=a);var r=s.p+s.u(t),i=new Error,c=function(n){if(s.o(e,t)&&(o=e[t],0!==o&&(e[t]=void 0),o)){var a=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.src;i.message="Loading chunk "+t+" failed.\n("+a+": "+r+")",i.name="ChunkLoadError",i.type=a,i.request=r,o[1](i)}};s.l(r,c,"chunk-"+t,t)}},s.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,a,r=n[0],i=n[1],c=n[2],u=0;if(r.some((function(t){return 0!==e[t]}))){for(o in i)s.o(i,o)&&(s.m[o]=i[o]);if(c)var d=c(s)}for(t&&t(n);u<r.length;u++)a=r[u],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return s.O(d)},n=self["webpackChunkvue_mesenger"]=self["webpackChunkvue_mesenger"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=s.O(void 0,[504],(function(){return s(5820)}));n=s.O(n)})();
//# sourceMappingURL=app.3d465ade.js.map